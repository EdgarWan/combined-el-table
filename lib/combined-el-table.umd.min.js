(function(e,t){"object"===typeof exports&&"object"===typeof module?module.exports=t():"function"===typeof define&&define.amd?define([],t):"object"===typeof exports?exports["combined-el-table"]=t():e["combined-el-table"]=t()})("undefined"!==typeof self?self:this,(function(){return function(e){var t={};function s(o){if(t[o])return t[o].exports;var n=t[o]={i:o,l:!1,exports:{}};return e[o].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,o){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},s.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(s.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(o,n,function(t){return e[t]}.bind(null,n));return o},s.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s="fb15")}({fb15:function(e,t,s){"use strict";if(s.r(t),"undefined"!==typeof window){var o=window.document.currentScript,n=o&&o.src.match(/(.+\/)[^/]+\.js(\?.*)?$/);n&&(s.p=n[1])}var a=function(){var e=this,t=e._self._c;return t("el-table",e._g(e._b({ref:"elTable",attrs:{data:e.tableData,"span-method":e.mergeEnabled?e.customSpanMethod:null}},"el-table",e.$attrs,!1),e.$listeners),[e._t("default")],2)},l=[],i={data(){return{_mergeCache:{},_dataVersion:"",_hasSorted:!1}},watch:{tableData:{handler(e,t){e!==t&&(this.clearMergeCache(),this._hasSorted=!1,this.$nextTick(()=>{this.autoUpdateCombinedKeys&&this.updateCombinedKeys()}))},deep:!0}},methods:{customSpanMethod({row:e,column:t,rowIndex:s,columnIndex:o}){if(!this.spanMethodColKeys||0===this.spanMethodColKeys.length)return{rowspan:1,colspan:1};if(0===s&&0===o&&this.handleDataSorting(),this.mergeActionColumns&&this.mergeActionColumns.length>0){const e=this.getActionColumnConfig(t.label);if(e)return this.calculateActionColumnSpan(s,e.level)}const n=this.getCurrentColumn(o);return n&&this.shouldMergeColumn(n.key)?this.calculateMergeSpan(s,n.key):{rowspan:1,colspan:1}},getActionColumnConfig(e){if(!e||!this.mergeActionColumns||0===this.mergeActionColumns.length)return null;for(const t of this.mergeActionColumns)if("string"===typeof t){if(t===e)return{label:e,level:1}}else if("object"===typeof t&&t.label===e)return{label:t.label,level:t.level||1};return null},calculateActionColumnSpan(e,t=1){this.tableData;const s=`action_merge_${e}_level${t}`;if(this._mergeCache&&void 0!==this._mergeCache[s])return this._mergeCache[s];let o=!1,n=1;1===t?e>0&&this.checkKeysMatch(e,this.spanMethodColKeys)?o=!0:n=this.calculatePrimaryMergeCount(e):2===t?(e>0&&this.checkKeysMatch(e,this.spanMethodColKeys)&&this.subSpanMethodColKeys&&this.checkKeysMatch(e,this.subSpanMethodColKeys)&&(o=!0),o||(n=this.calculateSecondaryMergeCount(e))):3===t&&(e>0&&this.checkKeysMatch(e,this.spanMethodColKeys)&&this.subSpanMethodColKeys&&this.checkKeysMatch(e,this.subSpanMethodColKeys)&&this.thirdSpanMethodColKeys&&this.checkKeysMatch(e,this.thirdSpanMethodColKeys)&&(o=!0),o||(n=this.calculateThirdMergeCount(e)));const a=o?{rowspan:0,colspan:0}:{rowspan:n,colspan:1};return this._mergeCache||(this._mergeCache={}),this._mergeCache[s]=a,a},calculateMergeSpan(e,t){this.tableData;let s=1;if(e>0&&this.shouldHideRow(e,t))return{rowspan:0,colspan:0};const o=this.calculateMergeCount(e,t);return s=o,{rowspan:s,colspan:1}},shouldHideRow(e,t){this.tableData;const s=`hide_${e}_${t}`;if(this._mergeCache&&void 0!==this._mergeCache[s])return this._mergeCache[s];let o=!1;return this.spanMethodColKeys.includes(t)&&(o=this.checkKeysMatch(e,this.spanMethodColKeys)),!o&&this.subSpanMethodColKeys&&this.subSpanMethodColKeys.includes(t)&&this.checkKeysMatch(e,this.spanMethodColKeys)&&(o=this.checkKeysMatch(e,this.subSpanMethodColKeys)),!o&&this.thirdSpanMethodColKeys&&this.thirdSpanMethodColKeys.includes(t)&&this.checkKeysMatch(e,this.spanMethodColKeys)&&this.checkKeysMatch(e,this.subSpanMethodColKeys)&&(o=this.checkKeysMatch(e,this.thirdSpanMethodColKeys)),this._mergeCache||(this._mergeCache={}),this._mergeCache[s]=o,o},checkKeysMatch(e,t){const s=this.tableData;for(const o of t)if(s[e][o]!==s[e-1][o])return!1;return!0},calculateMergeCount(e,t){this.tableData;const s=`merge_${e}_${t}`;if(this._mergeCache&&void 0!==this._mergeCache[s])return this._mergeCache[s];let o=1;return this.spanMethodColKeys.includes(t)&&(o=this.calculatePrimaryMergeCount(e)),this.subSpanMethodColKeys&&this.subSpanMethodColKeys.includes(t)&&(o=this.calculateSecondaryMergeCount(e)),this.thirdSpanMethodColKeys&&this.thirdSpanMethodColKeys.includes(t)&&(o=this.calculateThirdMergeCount(e)),this._mergeCache||(this._mergeCache={}),this._mergeCache[s]=o,o},calculatePrimaryMergeCount(e){const t=this.tableData,s=this.getCurrentValues(e,this.spanMethodColKeys);let o=1;for(let n=e+1;n<t.length;n++){if(!this.checkRowValuesMatch(n,s,this.spanMethodColKeys))break;o++}return o},calculateSecondaryMergeCount(e){const t=this.tableData,s=this.getCurrentValues(e,this.spanMethodColKeys),o=this.getCurrentValues(e,this.subSpanMethodColKeys);let n=1;for(let a=e+1;a<t.length;a++){if(!this.checkRowValuesMatch(a,s,this.spanMethodColKeys))break;if(!this.checkRowValuesMatch(a,o,this.subSpanMethodColKeys))break;n++}return n},calculateThirdMergeCount(e){const t=this.tableData,s=this.getCurrentValues(e,this.spanMethodColKeys),o=this.getCurrentValues(e,this.subSpanMethodColKeys),n=this.getCurrentValues(e,this.thirdSpanMethodColKeys);let a=1;for(let l=e+1;l<t.length;l++){if(!this.checkRowValuesMatch(l,s,this.spanMethodColKeys))break;if(!this.checkRowValuesMatch(l,o,this.subSpanMethodColKeys))break;if(!this.checkRowValuesMatch(l,n,this.thirdSpanMethodColKeys))break;a++}return a},getCurrentValues(e,t){const s=this.tableData,o={};for(const n of t)o[n]=s[e][n];return o},checkRowValuesMatch(e,t,s){const o=this.tableData;for(const n of s)if(o[e][n]!==t[n])return!1;return!0},calculateColumnOffsetFn(){return this.columnOffset||0},handleDataSorting(){if(this.tableData&&this.tableData.length>0){const e=JSON.stringify(this.tableData);this._dataVersion!==e&&(this._hasSorted=!1,this._dataVersion=e,this.clearMergeCache())}!this._hasSorted&&this.spanMethodColKeys&&this.spanMethodColKeys.length>0&&(this.autoSort&&this.sortDataBySpanMethodColKeys(),this._hasSorted=!0)},getCurrentColumn(e){const t=this.calculateColumnOffsetFn();let s=e-t;if(!this.columnList||0===this.columnList.length)return null;for(const o of this.columnList)if(o.subColumnList)for(const e of o.subColumnList){if(0===s)return e;s--}else{if(0===s)return o;s--}return null},shouldMergeColumn(e){return!!(this.spanMethodColKeys.includes(e)||this.subSpanMethodColKeys&&this.subSpanMethodColKeys.includes(e)||this.thirdSpanMethodColKeys&&this.thirdSpanMethodColKeys.includes(e))},sortDataBySpanMethodColKeys(){if(!this.spanMethodColKeys||0===this.spanMethodColKeys.length)return;if(!this.tableData||0===this.tableData.length)return;const e=[...this.tableData].sort((e,t)=>{for(let s=0;s<this.spanMethodColKeys.length;s++){const o=this.spanMethodColKeys[s],n=e[o]||"",a=t[o]||"";if(n<a)return-1;if(n>a)return 1}if(this.subSpanMethodColKeys&&this.subSpanMethodColKeys.length>0)for(let s=0;s<this.subSpanMethodColKeys.length;s++){const o=this.subSpanMethodColKeys[s],n=e[o]||"",a=t[o]||"";if(n<a)return-1;if(n>a)return 1}if(this.thirdSpanMethodColKeys&&this.thirdSpanMethodColKeys.length>0)for(let s=0;s<this.thirdSpanMethodColKeys.length;s++){const o=this.thirdSpanMethodColKeys[s],n=e[o]||"",a=t[o]||"";if(n<a)return-1;if(n>a)return 1}return 0});this.$emit("update:data",e)},clearMergeCache(){this._mergeCache={}},updateCombinedKeys(){const e=this.secondaryRecordKey,t=this.secondaryRecordValueKey||"tid",s=this.tableData||[];if(!s.length)return;s.forEach(e=>{this.$set(e,"combinedKeys","")});const o=this.spanMethodColKeys||[],n=this.subSpanMethodColKeys||[],a=this.thirdSpanMethodColKeys||[];let l=[];const i=["1","2","3",1,2,3].includes(e);if(i){const t=Number(e);1===t&&(l=[...o]),2===t&&(l=[...o,...n]),3===t&&(l=[...o,...n,...a])}else{if("string"!==typeof e||!e)return void s.forEach(e=>{const s=e&&e[t];this.$set(e,"combinedKeys",null!=s?String(s):"")});l=[...o,e]}const r=[];let h=0;const c=(e,t,s)=>{for(const o of s)if((e&&e[o])!==(t&&t[o]))return!1;return!0};while(h<s.length){let e=h+1;while(e<s.length&&c(s[h],s[e],l))e++;const t=e-h;r.push({startIndex:h,count:t,rows:s.slice(h,e)}),h=e}r.forEach(e=>{const s=e.rows.map(e=>e&&e[t]).filter(e=>void 0!==e&&null!==e&&""!==e).join(",");e.rows.forEach(e=>this.$set(e,"combinedKeys",s))})},getCurrentDisplayMode(){return this.spanMethodColKeys&&0!==this.spanMethodColKeys.length?this.subSpanMethodColKeys&&this.subSpanMethodColKeys.length>0?this.thirdSpanMethodColKeys&&this.thirdSpanMethodColKeys.length>0?"level3":"level2":"level1":"noMerge"}}},r={name:"CombinedElTable",mixins:[i],props:{data:{type:Array,default:()=>[]},mergeEnabled:{type:Boolean,default:!0},columnList:{type:Array,default:()=>[]},spanMethodColKeys:{type:Array,default:()=>[]},subSpanMethodColKeys:{type:Array,default:()=>[]},thirdSpanMethodColKeys:{type:Array,default:()=>[]},columnOffset:{type:Number,default:0},autoSort:{type:Boolean,default:!1},autoUpdateCombinedKeys:{type:Boolean,default:!1},secondaryRecordKey:{type:[String,Number],default:"1"},secondaryRecordValueKey:{type:String,default:"tid"},mergeActionColumns:{type:Array,default:()=>[]}},computed:{tableData:{get(){return this.data},set(e){this.$emit("update:data",e)}}},methods:{clearSelection(){this.$refs.elTable.clearSelection()},toggleRowSelection(e,t){this.$refs.elTable.toggleRowSelection(e,t)},toggleAllSelection(){this.$refs.elTable.toggleAllSelection()},toggleRowExpansion(e,t){this.$refs.elTable.toggleRowExpansion(e,t)},setCurrentRow(e){this.$refs.elTable.setCurrentRow(e)},clearSort(){this.$refs.elTable.clearSort()},clearFilter(e){this.$refs.elTable.clearFilter(e)},doLayout(){this.$refs.elTable.doLayout()},sort(e,t){this.$refs.elTable.sort(e,t)}}},h=r;function c(e,t,s,o,n,a,l,i){var r,h="function"===typeof e?e.options:e;if(t&&(h.render=t,h.staticRenderFns=s,h._compiled=!0),o&&(h.functional=!0),a&&(h._scopeId="data-v-"+a),l?(r=function(e){e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext,e||"undefined"===typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),n&&n.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(l)},h._ssrRegister=r):n&&(r=i?function(){n.call(this,(h.functional?this.parent:this).$root.$options.shadowRoot)}:n),r)if(h.functional){h._injectStyles=r;var c=h.render;h.render=function(e,t){return r.call(t),c(e,t)}}else{var u=h.beforeCreate;h.beforeCreate=u?[].concat(u,r):[r]}return{exports:e,options:h}}var u=c(h,a,l,!1,null,null,null),d=u.exports;d.installed=!1,d.install=function(e){d.installed||(d.installed=!0,e.component(d.name,d))},"undefined"!==typeof window&&window.Vue&&d.install(window.Vue);var f=d;t["default"]=f}})}));